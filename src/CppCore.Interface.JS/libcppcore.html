<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello World - AssemblyScript</title>
    <!--<script type="module" src="test2.mjs"></script>-->
  </head>
  <body>

    <script type="module">
      import { 
        Buffer,
        CString,
        BaseX,
        Base10,
        BASE10,
        BASE16,
        UInt32,
        UInt64,
        UInt128,
        UInt8192,
        AES
      } from './libcppcore.js'
      
      function testBuffer() {

          /*const bb = new Uint8Array(16.9);
          console.log(bb);
          const bb2 = new Uint8Array(bb);
          bb[0] = 0xFF;
          console.log(bb2);*/

          /*const b = new ArrayBuffer(16);
          const b2 = new Uint8Array(b);
          console.log("ORIG");
          console.log(typeof(b2));
          console.log(b2);
          console.log("SLICE");
          const bsl1 = b2.slice(0, 1);
          console.log(typeof(bsl1));
          bsl1[0] = 0xFF;
          console.log(bsl1);
          console.log(b2);*/
          
          /*console.log("SUBARRAY");
          const bsl2 = b2.subarray(0, 1);
          console.log(typeof(bsl2));
          console.log(bsl2);*/


          const buf = new Buffer(16);
          buf[0] = 0xFF;
          buf[1] = 0xFF;
          console.log(buf);
          console.log(buf.bitLength);
          buf.fill(0);
          console.log(buf);
          
          /*const buf2 = new Buffer(buf);
          console.log(buf2);
          
          const t1 = buf.slice(0, 1);
          console.log(typeof(t1));
          console.log(t1);

          const t2 = buf.subarray(0, 1);
          console.log(typeof(t2));
          console.log(t2);*/
      }

      function testCString() {
        var s = new CString("hello");
        console.log(s);
        /*console.log(s.toString());
        console.log(s.usedLength);
        console.log(s.maxLength);
        console.log(s._ptr);*/


        /*var s2 = s.slice(0, 1);
        console.log(s2);
        console.log(s2.usedLength);*/

        var s3 = new CString(s);
        //console.log(s3.toString());
        console.log(s3.usedLength);
        console.log(s3.maxLength);

        //var s4 = s.subarray(0, 1);
        //console.log(s4);
      }

      function testBaseX() {
        
        /*var s = new CString(31);
        console.log("LEN: " + s.byteLength);
        console.log("decoding...");
        var str1 = new CString("hello world");
        console.log(str1.toString());
        console.log("----------");
        str1.fromString("blabla");
        console.log(str1.toString());*/
             
        /*console.log("32B,B10:" + BaseX.estimateSymbols(32, 10));
        console.log("32B,B02:" + BaseX.estimateSymbols(32,  2));
        console.log("32B,B16:" + BaseX.estimateSymbols(32, 16));

        console.log("32B,B10:" + BaseX.estimateBits(11, 10));
        console.log("32B,B02:" + BaseX.estimateBits(32,  2));
        console.log("32B,B16:" + BaseX.estimateBits(8, 16));*/

        //

        /*var basex = new BaseX("0123456789");
        var dec = basex.decode("1024");
        console.log(dec);
        var enc = basex.encode(dec);
        console.log(enc);*/

        var basex = new BaseX("0123456789ABCDEF");
        var dec = basex.decode("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");
        console.log(dec);
        var enc = basex.encode(dec);
        console.log(enc);


        //console.log(dec._ptr);

        //var v = basex.decode128("9999999999999999999999999999999999999999999999999");
        //console.log(v);

      }

      function testUInt() {
        
        /*var sh = new UInt8192("0xFF");
        UInt32.shl(sh, 8, sh);
        console.log(sh.toString(16));
        sh.shr(8);
        console.log(sh.toString(16));*/

        var d = new UInt128("0x0C");
        var b = new UInt128("0x21");
        var m = new UInt128("0x7");
        var q = new UInt128();
        var r = new UInt128();
        //console.log(d.toString(16) + " ^ " + b.toString(16) + " % " + m.toString(16));
        //console.log(m.toString(16));
        //d.mul(b);
        //console.log(d.toString(16));
        //d.div(b, r);

        console.log("d: " + d.toString(16));
        console.log("b: " + b.toString(16));

        d.gcd(b);
        //UInt128.gcd(d, b, d);
        //UInt128.powmod(d, b, m, d);
        //d.powmod(b, m);
        //d.mod(b);
        console.log("d: " + d.toString(16));
        //console.log("r: " + r.toString(16));

        /*var c = new UInt128("568562345231");
        console.log(c.toString());
        var hex = new UInt128("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");
        console.log(hex.toString(16));*/
        
        //var basex = new BaseX("0123456789");
        //var basex = new Base10();
        /*var a = basex.decode("9999", 128);
        var b = basex.decode("1111", 128);
        var c = new UInt128(a);
        console.log(basex.encode(a));
        a.add(b);
        console.log(basex.encode(a));
        console.log(basex.encode(c));*/
        
        /*var a = BASE10.decode("9999", 128);
        var b = new UInt64(a);
        console.log(BASE10.encode(a));
        console.log(BASE10.encode(b));*/

        //console.log(basex.encode(b.test()));
      }

      function testAES() {
        var aes = new AES();
        var key = new AES.Key();
        key.setUint32(0, 4294967295);

        aes.reset(key);
        var data_in = new Buffer(16);
        var data_out = new Buffer(16);
        
        data_out.setUint32(0, 0);
        data_out.setUint32(4, 0);
        data_out.setUint32(8, 0);
        data_out.setUint32(12, 0);
        
        data_in.setUint32(0, 4294967295);
        data_in.setUint32(4, 4294967295);
        data_in.setUint32(8, 4294967295);
        data_in.setUint32(12, 4294967295);

        console.log("Before:")
        console.log(data_out.getUint32(0));
        aes.encrypt(data_in, data_out, 1);
        console.log("After:")
        console.log(data_out.getUint32(0));

        data_in.setUint32(0, 0);
        data_in.setUint32(4, 0);
        data_in.setUint32(8, 0);
        data_in.setUint32(12, 0);

        console.log("Before:")
        console.log(data_in.getUint32(0));
        aes.decrypt(data_out, data_in, 1);
        console.log("After:")
        console.log(data_in.getUint32(0));
      }

      //testBuffer();
      //testCString();
      //testBaseX();
      testUInt();

    </script>
  </body>
</html>
